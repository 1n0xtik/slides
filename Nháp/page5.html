<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Câu 4 - Y tế - Cấp cứu</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }
        body, html {
            height: 100%;
            margin: 0;
            overflow: hidden; 
        }
        .slide-container {
            width: 100vw; 
            height: 100vh; 
            margin: 0;
            display: flex;
            flex-direction: column;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #dc2626 0%, #ef4444 50%, #fecaca 100%);
        }
        .text-shadow {
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .question-appear {
            animation: questionSlideIn 1s ease-out forwards;
            opacity: 0;
            transform: translateY(-30px);
        }
        .option-appear {
            animation: optionSlideIn 0.8s ease-out forwards;
            opacity: 0;
            transform: translateX(-50px);
        }
        .correct-answer { /* For page5, this will highlight the "SAI" answer */
            animation: correctAnswerPulse 2s ease-in-out infinite;
            background: linear-gradient(45deg, #f59e0b, #fbbf24) !important; /* Adjusted for "wrong" answer highlight */
            color: white !important;
            border: 3px solid #991b1b !important; /* Darker red border */
            box-shadow: 0 0 30px rgba(245, 158, 11, 0.6) !important;
        }
        .timer-circle {
            stroke-dasharray: 283;
            stroke-dashoffset: 283;
            transition: stroke-dashoffset 1s linear;
        }
        .timer-active {
            animation: timerCountdown 60s linear forwards;
        }
        @keyframes questionSlideIn {
            0% { opacity: 0; transform: translateY(-30px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        @keyframes optionSlideIn {
            0% { opacity: 0; transform: translateX(-50px); }
            100% { opacity: 1; transform: translateX(0); }
        }
        @keyframes correctAnswerPulse { /* Keep pulse, color changed above */
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        @keyframes timerCountdown {
            0% { stroke-dashoffset: 283; }
            100% { stroke-dashoffset: 0; }
        }
        .option-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .option-card:hover {
            transform: translateX(10px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .pulse-icon {
            animation: pulseIcon 2s infinite;
        }
        @keyframes pulseIcon {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .speaking {
            background: linear-gradient(45deg, #f59e0b, #fbbf24) !important;
            animation: speakingPulse 1s ease-in-out infinite;
        }
        @keyframes speakingPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
    </style>
</head>
<body>
    <div class="slide-container gradient-bg relative overflow-hidden flex flex-col">
        <!-- Header -->
        <div class="flex justify-between items-center px-8 py-4 flex-shrink-0">
            <div class="flex items-center space-x-4">
                <div class="bg-red-600 text-white px-4 py-2 rounded-full font-bold">
                    <i class="fas fa-heartbeat mr-2"></i>Câu 4
                </div>
                <div class="text-white font-semibold">
                    <i class="fas fa-user-md mr-2"></i>Y tế - Cấp cứu
                </div>
            </div>
            
            <!-- Timer -->
            <div class="relative">
                <svg class="w-20 h-20 transform -rotate-90">
                    <circle cx="40" cy="40" r="35" stroke="#fde68a" stroke-width="6" fill="transparent"/> <!-- Lighter stroke for contrast on red -->
                    <circle id="timerCircle" cx="40" cy="40" r="35" stroke="#facc15" stroke-width="6" fill="transparent" 
                            class="timer-circle"/> <!-- Yellow timer for contrast -->
                </svg>
                <div class="absolute inset-0 flex items-center justify-center">
                    <span id="timerText" class="text-white font-bold text-lg">60</span>
                </div>
            </div>
        </div>

        <!-- Main Content Area (Question & Options) -->
        <div class="px-8 py-2 flex-grow overflow-y-auto">
            <div id="questionSection" class="bg-white bg-opacity-95 rounded-xl p-4 mb-4 question-appear">
                <div class="flex items-start space-x-4">
                    <div class="bg-red-600 text-white rounded-full p-3 pulse-icon">
                        <i class="fas fa-exclamation-triangle text-2xl"></i>
                    </div>
                    <div class="flex-1">
                        <h2 id="questionTextContent" class="text-xl font-bold text-gray-800 mb-2">
                            Anh/Chị hãy đánh dấu câu SAI trong nội dung cấp cứu ngừng tim, ngừng thở do điện giật?
                        </h2>
                    </div>
                </div>
            </div>

            <!-- Options -->
            <div class="space-y-2 mb-4">
                <div id="optionA" data-text="Nếu nạn nhân bất tỉnh ngừng tim, ngừng thở do điện giật thì phải được tách khỏi nguồn điện rồi mới tiến hành cấp cứu." class="option-card bg-white bg-opacity-90 rounded-lg p-3 border-l-4 border-red-500" style="opacity: 0;">
                    <div class="flex items-start space-x-3">
                        <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold mt-1">A</div>
                        <span class="text-gray-800 font-medium text-sm">Nếu nạn nhân bất tỉnh ngừng tim, ngừng thở do điện giật thì phải được tách khỏi nguồn điện rồi mới tiến hành cấp cứu.</span>
                    </div>
                </div>
                
                <div id="optionB" data-text="Để nạn nhân nằm ngửa trên mặt phẳng cứng, cấp cứu viên quỳ sát bên nạn nhân, đặt gót tay lên xương ức, cách mỏm ức khoảng 3cm, tay kia đè chồng lên và dùng sức của cả cơ thể ấn xuống hai tay tạo áp lực mạnh làm lún xương ức rồi thả ra." class="option-card bg-white bg-opacity-90 rounded-lg p-3 border-l-4 border-blue-500" style="opacity: 0;">
                    <div class="flex items-start space-x-3">
                        <div class="bg-blue-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold mt-1">B</div>
                        <span class="text-gray-800 font-medium text-sm">Để nạn nhân nằm ngửa trên mặt phẳng cứng, cấp cứu viên quỳ sát bên nạn nhân, đặt gót tay lên xương ức, cách mỏm ức khoảng 3cm, tay kia đè chồng lên và dùng sức của cả cơ thể ấn xuống hai tay tạo áp lực mạnh làm lún xương ức rồi thả ra.</span>
                    </div>
                </div>
                
                <div id="optionC" data-text="Nếu chỉ có một cấp cứu viên thì cứ ép tim 15 lần trong 11-12 giây lại quay ra thổi ngạt 2 lần trong 3-4 giây. Nếu có hai cấp cứu viên thì cứ ép tim 5 lần lại để người kia thổi ngạt 1 lần." class="option-card bg-white bg-opacity-90 rounded-lg p-3 border-l-4 border-green-500" style="opacity: 0;">
                    <div class="flex items-start space-x-3">
                        <div class="bg-green-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold mt-1">C</div>
                        <span class="text-gray-800 font-medium text-sm">Nếu chỉ có một cấp cứu viên thì cứ ép tim 15 lần trong 11-12 giây lại quay ra thổi ngạt 2 lần trong 3-4 giây. Nếu có hai cấp cứu viên thì cứ ép tim 5 lần lại để người kia thổi ngạt 1 lần.</span>
                    </div>
                </div>
                
                <div id="optionD" data-text="Sau khi cấp cứu thành công, để nạn nhân ở tư thế thoải mái, kê đầu vai cao hơn một chút cho dễ thở." class="option-card bg-white bg-opacity-90 rounded-lg p-3 border-l-4 border-yellow-500" style="opacity: 0;">
                    <div class="flex items-start space-x-3">
                        <div class="bg-yellow-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold mt-1">D</div>
                        <span class="text-gray-800 font-medium text-sm">Sau khi cấp cứu thành công, để nạn nhân ở tư thế thoải mái, kê đầu vai cao hơn một chút cho dễ thở.</span>
                    </div>
                </div>
                
                <div id="optionE" data-text="Nếu nạn nhân bị các chấn thương khác kèm theo thì ưu tiên xử lý vết thương trước." class="option-card bg-white bg-opacity-90 rounded-lg p-3 border-l-4 border-purple-500" style="opacity: 0;">
                    <div class="flex items-start space-x-3">
                        <div class="bg-purple-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold mt-1">E</div>
                        <span class="text-gray-800 font-medium text-sm">Nếu nạn nhân bị các chấn thương khác kèm theo thì ưu tiên xử lý vết thương trước.</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer Area (Progress & Controls) -->
        <div class="px-8 py-4 flex-shrink-0 flex justify-between items-end">
            <!-- Progress indicator -->
            <div class="text-left">
                <div id="progressText" class="text-white font-semibold text-sm">
                     <!-- Initial text removed, will be updated by JS -->
                </div>
            </div>

            <!-- Control Panel -->
            <div class="flex space-x-3">
                <button id="readBtn" class="bg-purple-700 hover:bg-purple-800 text-white px-4 py-3 rounded-lg font-semibold transition-all text-xl"> <!-- Darker purple for red bg -->
                    <i class="fas fa-volume-up"></i>
                </button>
                <button id="nextBtn" class="bg-red-700 hover:bg-red-800 text-white px-4 py-3 rounded-lg font-semibold transition-all text-xl"> <!-- Darker red for red bg -->
                    <i class="fas fa-arrow-right"></i>
                </button>
                <button id="showAnswerBtn" class="bg-yellow-500 hover:bg-yellow-600 text-gray-800 px-4 py-2 rounded-lg font-semibold transition-all text-sm" style="display: none;"> <!-- Yellow for contrast -->
                    <i class="fas fa-lightbulb mr-2"></i>Hiển thị đáp án
                </button>
            </div>
        </div>
    </div>

    <script>
        let timerInterval;
        let timeLeft = 60;
        let speechEnabled = true;
        let audioContext;
        let optionsShown = false;
        let timerStarted = false;

        const questionElement = document.getElementById('questionTextContent');
        const optionElements = {
            A: document.getElementById('optionA'),
            B: document.getElementById('optionB'),
            C: document.getElementById('optionC'),
            D: document.getElementById('optionD'),
            E: document.getElementById('optionE')
        };
        const readBtn = document.getElementById('readBtn');
        const nextBtn = document.getElementById('nextBtn');
        const showAnswerBtn = document.getElementById('showAnswerBtn');
        const progressText = document.getElementById('progressText');
        const timerCircle = document.getElementById('timerCircle');
        const timerText = document.getElementById('timerText');

        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }
        
        function playSound(type, frequency, duration) {
            if (!audioContext || !speechEnabled) return;
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            oscillator.type = type; 
            oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime); 
            oscillator.start();
            oscillator.stop(audioContext.currentTime + duration);
        }

        function playStartSound() { playSound('sine', 660, 0.2); }
        function playTickSound(remainingSeconds) {
            const freq = remainingSeconds <= 3 ? 1200 - (remainingSeconds * 100) : 880;
            playSound('triangle', freq, 0.1); 
        }
        function playEndSound() {
            playSound('square', 440, 0.5); 
            setTimeout(() => playSound('square', 440, 0.3), 600);
        }
        
        async function speakTextAsync(text, onEndCallback) {
            if (!speechEnabled || !text) return Promise.resolve();
            readBtn.classList.add('speaking');
            readBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            return new Promise((resolve) => {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'vi-VN';
                utterance.rate = 0.9; 
                utterance.onend = function() {
                    readBtn.classList.remove('speaking');
                    readBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
                    if (onEndCallback) onEndCallback();
                    resolve();
                };
                utterance.onerror = function(event) {
                    console.error('Speech synthesis error:', event.error);
                    readBtn.classList.remove('speaking');
                    readBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
                    if (onEndCallback) onEndCallback();
                    resolve(); 
                };
                speechSynthesis.speak(utterance);
            });
        }
        
        function showOption(optionKey, delay = 0) {
            const optionEl = optionElements[optionKey];
            if (optionEl) {
                optionEl.style.animationDelay = `${delay}s`;
                optionEl.classList.add('option-appear');
                optionEl.style.opacity = '1';
            }
        }

        async function speakAndShowSequentially() {
            if (optionsShown || timerStarted) return;
            initAudio(); 
            const questionTextVal = questionElement.innerText.trim();
            await speakTextAsync(questionTextVal);

            const optionOrder = ['A', 'B', 'C', 'D', 'E'];
            for (let i = 0; i < optionOrder.length; i++) {
                const key = optionOrder[i];
                const optionEl = optionElements[key];
                const optionFullText = `${key}. ${optionEl.dataset.text}`;
                await speakTextAsync(optionFullText);
                showOption(key, 0); 
                await new Promise(resolve => setTimeout(resolve, 200)); 
            }
            optionsShown = true;
            progressText.innerHTML = '<i class="fas fa-clock mr-2"></i>Tất cả phương án đã hiển thị. Đếm ngược bắt đầu!';
            startTimer();
            nextBtn.disabled = true;
            nextBtn.classList.add('opacity-50', 'cursor-not-allowed');
            readBtn.disabled = true; 
            readBtn.classList.add('opacity-50', 'cursor-not-allowed');
        }

        function showAllOptions() {
            if (optionsShown || timerStarted) return;
            initAudio(); 
            const optionOrder = ['A', 'B', 'C', 'D', 'E'];
            optionOrder.forEach((key, index) => {
                showOption(key, index * 0.15); 
            });
            optionsShown = true;
            progressText.innerHTML = '<i class="fas fa-clock mr-2"></i>Tất cả phương án đã hiển thị. Đếm ngược bắt đầu!';
            startTimer();
            nextBtn.disabled = true;
            nextBtn.classList.add('opacity-50', 'cursor-not-allowed');
            readBtn.disabled = true; 
            readBtn.classList.add('opacity-50', 'cursor-not-allowed');
        }

        function startTimer() {
            if (timerStarted) return;
            timerStarted = true;
            playStartSound();
            timerCircle.classList.add('timer-active');
            timerInterval = setInterval(() => {
                timeLeft--;
                timerText.textContent = timeLeft;
                if (timeLeft > 0 && timeLeft <= 6) { playTickSound(timeLeft); }
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    timerText.textContent = '0';
                    playEndSound();
                    progressText.innerHTML = '<i class="fas fa-hand-paper mr-2"></i>Hết thời gian! Các đội hãy giơ đáp án.';
                    showAnswerBtn.style.display = 'inline-block';
                    readBtn.disabled = false; 
                    readBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            }, 1000);
        }

        function showAnswer() {
            const incorrectStatementOption = optionElements['E']; // E is the incorrect statement
            incorrectStatementOption.classList.add('correct-answer'); // Highlight E as the "answer" to "find the wrong one"
            
            const answerText = 'Câu SAI là E: Nếu nạn nhân bị các chấn thương khác kèm theo thì ưu tiên cấp cứu ngừng tim, ngừng thở trước.';
            progressText.innerHTML = `<i class="fas fa-times-circle mr-2 text-yellow-300"></i>${answerText}`; // Yellow icon for contrast
            
            speakTextAsync(answerText);
            showAnswerBtn.disabled = true;
            showAnswerBtn.classList.add('opacity-50', 'cursor-not-allowed');
        }

        readBtn.addEventListener('click', () => { if (!readBtn.disabled) { speakAndShowSequentially(); } });
        nextBtn.addEventListener('click', () => { if (!nextBtn.disabled) { showAllOptions(); } });
        showAnswerBtn.addEventListener('click', showAnswer);

        document.addEventListener('keydown', (e) => {
            if ((e.key === 'ArrowRight' || e.key === ' ') && !nextBtn.disabled) { e.preventDefault(); showAllOptions(); } 
            else if (e.key === 'ArrowUp' && !readBtn.disabled) { e.preventDefault(); speakAndShowSequentially(); } 
            else if ((e.key === 'r' || e.key === 'R') && !readBtn.disabled) { e.preventDefault(); speakAndShowSequentially(); } 
            else if (timeLeft <= 0 && e.key === 'Enter' && showAnswerBtn.style.display !== 'none' && !showAnswerBtn.disabled) { e.preventDefault(); showAnswer(); }
        });
        progressText.innerHTML = '<i class="fas fa-info-circle mr-2"></i>Nhấn loa để đọc hoặc mũi tên để hiện đáp án.';
    </script>
</body>
</html>
